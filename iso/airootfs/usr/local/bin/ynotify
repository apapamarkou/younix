#!/bin/bash

# __   __    _   _ _   _ ___  __
# \ \ / /__ | | | | \ | (_) \/ /
#  \ V / _ \| | | |  \| | |\  / 
#   | | (_) | |_| | |\  | |/  \ 
#   |_|\___/ \___/|_| \_|_/_/\_\
#
# License GPL3
# Homepage: https://github.com/apapamarkou/younix
# Author: Andrianos Papamarkou
# Email: papamarkoua@gmail.com

#
# YoUNiX Notify
#

SCRIPT_NAME=$(basename "$0")
TITLE=""
BODY=""
LEFT_ACTION=""
RIGHT_ACTION=""
PRIMARY_TITLE=""
SECONDARY_TITLE=""
TIME=""

showHelp() {
    echo "$DISTRO_NAME $SCRIPT_NAME"
    echo "Usage: $SCRIPT_NAME [OPTIONS] TITLE BODY"
    echo "Options:"
    echo "  -l ACTION    Primary (Left click) action command"
    echo "  -p ACTION    Primary (Left click) action button title"
    echo "  -r ACTION    Secondary (Right click) action command"
    echo "  -s ACTION    Secondary (Right click action button title"
    echo "  -t TIME      Time to show notification (milliseconds)"
    echo "  -h           Show this help"
}

# Parse all arguments to handle mixed order
args=("$@")
for ((i=0; i<${#args[@]}; i++)); do
    case "${args[i]}" in
        -l) LEFT_ACTION="${args[i+1]}"; ((i++)) ;;
        -p) PRIMARY_TITLE="${args[i+1]}"; ((i++)) ;;
        -r) RIGHT_ACTION="${args[i+1]}"; ((i++)) ;;
        -s) SECONDARY_TITLE="${args[i+1]}"; ((i++)) ;;
        -t) TIME="${args[i+1]}"; ((i++)) ;;
        -h) showHelp; exit 0 ;;
        -*) echo "Invalid option: ${args[i]}"; exit 1 ;;
        *) if [[ -z "$TITLE" ]]; then
               TITLE="${args[i]}"
           elif [[ -z "$BODY" ]]; then
               BODY="${args[i]}"
           fi ;;
    esac
done

[[ -z "$TITLE" ]] && { echo "Error: Title required"; exit 1; }

# Execute notification with actions
if [[ -n "$LEFT_ACTION" || -n "$RIGHT_ACTION" ]]; then
    cmd=("notify-send")
    [[ -n "$TIME" ]] && cmd+=("-t" "$TIME")
    cmd+=("$TITLE")
    [[ -n "$BODY" ]] && cmd+=("$BODY")
    [[ -n "$LEFT_ACTION" ]] && cmd+=("--action=left=${PRIMARY_TITLE:-Left Click}")
    [[ -n "$RIGHT_ACTION" ]] && cmd+=("--action=right=${SECONDARY_TITLE:-Right Click}")
    cmd+=("--wait")
    
    action=$("${cmd[@]}")
    case "$action" in
        left) echo "Left Click"; eval "$LEFT_ACTION" & ;;
        right) echo "Right Click"; eval "$RIGHT_ACTION" & ;;
    esac
else
    if [[ -n "$BODY" ]]; then
        [[ -n "$TIME" ]] && notify-send -t "$TIME" "$TITLE" "$BODY" || notify-send "$TITLE" "$BODY"
    else
        [[ -n "$TIME" ]] && notify-send -t "$TIME" "$TITLE" || notify-send "$TITLE"
    fi
fi

