#!/usr/bin/env bash

# __   __    _   _ _   _ ___  __
# \ \ / /__ | | | | \ | (_) \/ /
#  \ V / _ \| | | |  \| | |\  / 
#   | | (_) | |_| | |\  | |/  \ 
#   |_|\___/ \___/|_| \_|_/_/\_\
#
# Lisence GPL3
# Homepage: https://github.com/apapamarkou/younix
# Author: Andrianos Papamarkou
# Email: papamarkoua@gmail.com

# Screen Recording Script for YOUNIX desktop environment

DIR="$HOME/Videos/ScreenRecords"
mkdir -p "$DIR"
FILE="$DIR/record_$(date +%Y-%m-%d_%H-%M-%S).mkv"

MODE=$1

# Default: region recording
MODE=${MODE:-region}

sleep 1.1

case "$MODE" in
    fullscreen)
        wf-recorder -f "$FILE"
        ;;

    region)
        wf-recorder -g "$(slurp)" -f "$FILE"
        ;;

    window)
        wf-recorder -g "$(hyprctl activewindow -j | jq -r '.at[0],.at[1],.size[0],.size[1]' | tr '\n' ',' | sed 's/,$//' | sed 's/,/ /g' | awk '{print $1","$2" "$3"x"$4}')" -f "$FILE"
        ;;

    stop)
        pkill -SIGINT wf-recorder
        exit 0
        ;;

    *)
        echo "Usage: $0 [fullscreen|region|window|stop]"
        exit 1
        ;;
esac

notify-send -t 10000 -A "Play video" "Screen recording saved" "$FILE" | while read action; do
    if [ "$action" = "0" ]; then
        mpv "$FILE"
    fi
done &
