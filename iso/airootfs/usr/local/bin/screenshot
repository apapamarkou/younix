#!/usr/bin/env bash

# __   __    _   _ _   _ ___  __
# \ \ / /__ | | | | \ | (_) \/ /
#  \ V / _ \| | | |  \| | |\  / 
#   | | (_) | |_| | |\  | |/  \ 
#   |_|\___/ \___/|_| \_|_/_/\_\
#
# Lisence GPL3
# Homepage: https://github.com/apapamarkou/younix
# Author: Andrianos Papamarkou
# Email: papamarkoua@gmail.com

# Screenshot tool for YOUNIX desktop environment

DIR="$HOME/Pictures/Screenshots"
mkdir -p "$DIR"
FILE="$DIR/screenshot_$(date +%Y-%m-%d_%H-%M-%S).png"

# Default argument: region
MODE=${1:-region}

sleep 1.1

case "$MODE" in
    fullscreen)
        grim "$FILE" && wl-copy < "$FILE"
        ;;

    region)
        grim -g "$(slurp)" "$FILE" && wl-copy < "$FILE"
        ;;

    window)
        # Active window
        grim -g "$(hyprctl activewindow -j | jq -r '.at[0],.at[1],.size[0],.size[1]' | tr '\n' ',' | sed 's/,$//' | sed 's/,/ /g' | awk '{print $1","$2" "$3"x"$4}')" "$FILE" && wl-copy < "$FILE"
        ;;

    *)
        echo "Usage: $0 [fullscreen|region|window]"
        exit 1
        ;;
esac

# Notification with action to open with ksnip
notify-send -t 10000 -A "Annotate" "Screenshot saved" "$FILE" | while read action; do
    if [ "$action" = "0" ]; then
        ksnip "$FILE"
    fi
done &
